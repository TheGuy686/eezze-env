# Eezze environment setup

## Installation

Install dependencies with `./install-dependencies.sh`, this will install Ansible and Vagrant on Ubuntu 18.04 and later.

> Automated Virtual Machine installation? Start [here](/vagrant/README.md).

> Automated remote machine installation? Start [here](/ansible/README.md).

> Automated Docker container installation? Start [here](/docker/README.md).

## Remote access via SSH

After the full installation is done with Vagrant; to connect via SSH / VSCode make the following configuration in your `./ssh/config` file:

```bash
Host *
  ServerAliveInterval 300

Host eezze
  HostName eezze
  Port 22
  User vagrant
  IdentityFile /home/rolfstreefkerk/Projects/eezze/eezze-docker-env/vagrant/.vagrant/machines/default/virtualbox/private_key
```

The first two lines sets the connection *keep alive* to avoid `broken pipe` errors.

Hostname is either the `IP` set for this machine or it's the `name` set with this script; `./vagrant/set-hosts-file.sh`, standard user; `vagrant`. The `IdentityFile` is typically located in the `.vagrant` directory as indicated, this is autogenerated during installation.

From VSCode you can select this host and it will install the VSCode server on the guest machine and you have full access.

From your terminal application, run; `ssh eezze` to connect a remote session. The password is `vagrant` when using the Vagrant setup. Once logged in, you can use `ctop` to manage all the containers.

Alternatively, you can install `Remmina`. A GTK based RDP/SSH client, that I've found to be more stable than `Konsole` for ssh sessions. 

```bash
sudo apt install remmina
``` 

### Start-vm.sh script

Check the variables in the `start-vm.sh` script first, particularly the `adapter` variable. Find out what your primary adapter name is;

```bash
ip -o -f inet addr show
```

has result;

```bash
1: lo    inet 127.0.0.1/8 scope host lo\       valid_lft forever preferred_lft forever
3: wlp82s0    inet 192.168.208.125/24 brd 192.168.208.255 scope global dynamic noprefixroute wlp82s0\       valid_lft 3237sec preferred_lft 3237sec
```

and then set the variable; `adapter="wlp82s0"` such that it gets the IP Address from the correct network adapter your VM is connected to.

If you like to use `Remmina`. In the `start-vm.sh` script, you can enable the `remmina` execution instead of the default `ssh eezze`, make sure the script name matches.

```bash
remmina -c ~/.local/share/remmina/group_ssh_eezze_eezze.remmina
```

> **Please note** for each IP Address change; you will need to restart the docker containers within the VM with this script; `~/eezze-docker-env/run.sh` such that the containers use the correct `HOST_IP` environment variable value.

### Git

Once connected to the VM, to push Git changes; make sure to set these options first:

```bash
git config --global user.email "john@doe.com"
git config --global user.name "John Doe"
```

### Error resolution

> Resolver error: Error: Remote host key has changed, port forwarding is disabled

This happens because the key has changed for that specific IP address in your `./ssh/known_hosts` file, clear the hosts file or find the exact signature and delete it.

To clear the host file:

```bash
echo "" > ./.ssh/known_hosts`
```

> HOST_IP in environment empty

For some reason the `ip-service.sh` script can run earlier than the network service and the `HOST_IP` is empty. For that reason I've included an `echo HOST_IP` on session connect, if it's empty, restart the VM.

> HOST_IP correct, container using the wrong IP Address

Go to `~/eezze-docker-env` and run `./run.sh` to stop and start the containers, this will load the correct IP Address from the HOST_IP env config.

## Specifics

Refer to these docs for Vagrant, Docker or Ansible specifics:

- [Vagrant docs](/vagrant/README.md)
- [Ansible docs](/ansible/README.md)
- [Docker docs](/docker/README.md)